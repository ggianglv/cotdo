<!-- 博文的布局-Layout -->
<!DOCTYPE html>
<html>
<head>
<!-- 引入head标签 -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-sclable=0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="description" content="Trong file script có sẵn của kintone thì đã implement sẵn sự kiện onbeforeunload để thông báo khi rời trang. Nhiều khi cái thông báo đó rất là khó chịu. Và hôm nay mình đã phải bỏ sự kiện onbeforeunload trong một file script khác." />
<meta name="keywords" content="" />
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/media.css">
<link rel="stylesheet" href="/assets/css/animate.min.css">
<link rel="stylesheet" href="/assets/css/pygments/pygments_default.css">
<link rel="stylesheet" href="/assets/css/github-markdown.css">
<!-- SNS-icon -->
<script src="/assets/js/sns-icon.js"></script>
<!-- share.css -->
<link rel="stylesheet" href="/assets/css/share.min.css">
<!-- font -->
<link rel="stylesheet" href="/assets/css/font.css">
<!-- <link href="https://fonts.googleapis.com/css?family=Kaushan+Script|Pacifico|Ubuntu|Roboto+Mono|Source+Sans+Pro" rel="stylesheet"> -->

<!-- Favicon -->
<link href="/assets/profile.jpg" rel="shortcut icon" />
<link href="/assets/profile.jpg" rel="apple-touch-icon-precomposed" />
<!-- Android Lolipop Theme Color -->
<!-- <meta name="theme-color" content="#1464FB"> -->
<title>Xóa sự kiện beforeunload trong javascript</title>
<!-- 百度统计 -->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- 谷歌分析 -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-174163233-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-174163233-1');
</script>

<!-- Android Lolipop Theme Color -->
<meta name="theme-color" content=" rgb(255,210,32) ">
</head>
<body>

<!-- 顶部锚点 -->
<a id="htmlup" name="htmlup"></a>
<!-- 引入博文顶部选项 -->

<header id="post-header" style="background-color:rgb(255,210,32);">
  <div class="top-center">
      <div class="logo">
          <a href="/" title="my awesome webtitle" style="color: white;">Cốt đơ</a>
      </div>
      <nav class="top-nav">
          <ul>
              
                <li><a href="/" style="color: white;">Home</a></li>
              
                <li><a href="/tags.html" style="color: white;">Tags</a></li>
              
                <li><a href="/timeline.html" style="color: white;">Timeline</a></li>
              
                <li><a href="/about.html" style="color: white;">About</a></li>
              
          </ul>
      </nav>
      <div id="top-boot">
        <a href="javascript:;" id="boot1" style="display:block;" onclick="document.getElementById('boot-area').style.display='block';document.getElementById('boot1').style.display='none';document.getElementById('boot2').style.display='block';"><img src="/assets/boot_white.png" alt=""></a>
        <a href="javascript:;" id="boot2" style="display: none;" onclick="document.getElementById('boot-area').style.display='none';document.getElementById('boot1').style.display='block';document.getElementById('boot2').style.display='none';"><img src="/assets/boot_white.png" alt=""></a>
      </div>
  </div>

</header>


<!-- 引入移动下拉选项 -->
<div id="boot-area">
    <ul>
        
          <a href="/"><li>Home</li></a>
        
          <a href="/tags.html"><li>Tags</li></a>
        
          <a href="/timeline.html"><li>Timeline</li></a>
        
          <a href="/about.html"><li>About</li></a>
        
    </ul>
</div>

<!-- 引入博文顶部样式 -->
<!-- 版本一 垃圾 -->
<!-- <div class="wow fadeIn top" data-wow-duration="3.5s" >
    <span class="wow fadeInUp" data-wow-delay="0.2s">Xóa sự kiện beforeunload trong javascript</span>
    <span class="wow fadeInUp" data-wow-delay="0.4s">Trong file script có sẵn của kintone thì đã implement sẵn sự kiện onbeforeunload để thông báo khi rời trang. Nhiều khi cái thông báo đó rất là khó chịu. Và hôm nay mình đã phải bỏ sự kiện onbeforeunload trong một file script khác.</span>
    <span class="wow fadeInUp" data-wow-delay="0.4s">Trong file script có sẵn của kintone thì đã implement sẵn sự kiện onbeforeunload để thông báo khi rời trang. Nhiều khi cái thông báo đó rất là khó chịu. Và hôm nay mình đã phải bỏ sự kiện onbeforeunload trong một file script khác.</span>
    <span class="wow fadeInUp" data-wow-delay="0.6s">作者&nbsp;&nbsp;|&nbsp;&nbsp;Giangg</span>
</div> -->

<!-- 版本二 可切换页面 -->

<div class="post-top" style="background-color:rgb(255,210,32);">
  <!-- 页面宽度大于800px -->
  <div class="left-area">
    
      <a href="javascript:;" class="btn bounceInLeft animated" onmouseover="showLeft();this.style.color='rgb(255,210,32)';" onmouseout="goneLeft();this.style.color='rgba(0,0,0,.2)';"><</a>
      <div id="left-tab" style="display:none;"><span class="left-san"></span><span class="left-main" style="color:rgb(255,210,32);"><sapn class="main">没有上一页咯</sapn></span></div>
    
  </div>
  <div class="post-titlearea">
    <h1 class="wow fadeInUp" data-wow-delay="0.2s">Xóa sự kiện beforeunload trong javascript</h1>
    <!-- <span class="wow fadeInUp" data-wow-delay="0.4s">Trong file script có sẵn của kintone thì đã implement sẵn sự kiện onbeforeunload để thông báo khi rời trang. Nhiều khi cái thông báo đó rất là khó chịu. Và hôm nay mình đã phải bỏ sự kiện onbeforeunload trong một file script khác.</span> -->
    <!-- <span class="wow fadeInUp" data-wow-delay="0.4s">Trong file script có sẵn của kintone thì đã implement sẵn sự kiện onbeforeunload để thông báo khi rời trang. Nhiều khi cái thông báo đó rất là khó chịu. Và hôm nay mình đã phải bỏ sự kiện onbeforeunload trong một file script khác.</span> -->
    <!-- <span class="wow fadeInUp" data-wow-delay="0.6s">作者&nbsp;&nbsp;|&nbsp;&nbsp;Giangg</span> -->
  </div>
  <div class="right-area">
    
      <a href="/deploy-react-app-len-github-page.html" class="btn bounceInRight self-animated" onmouseover="showRight();this.style.color='rgb(255,210,32)';" onmouseout="goneRight();this.style.color='rgba(0,0,0,.2)';">></a>
      <div id="right-tab" style="display:none;"><span class="right-san"></span><span class="right-main" style="color:rgb(255,210,32);"><sapn class="main">Deploy react app lên github page</sapn></span></div>
    
  </div>

  <!-- 页面宽度小于800px -->
  <div class="post-changearea">
    
      <a href="javascript:;" class="leftchange" style="border-right: 1px solid rgb(255,210,32);border-bottom: 2px solid rgb(255,210,32);"><span><br>...</span></a>
    
    
      <a href="/deploy-react-app-len-github-page.html" class="rightchange" style="border-left: 1px solid rgb(255,210,32);border-bottom: 2px solid rgb(255,210,32);"><span>Bài trước<br><br>Deploy react app lên github page</span></a>
    
  </div>
</div>


<div class="markdown-body fadeInUp animated">

  

  <!-- 文章内容 -->
  <p>Ngày hôm nay mình đã gặp được 1 vấn đề khá là hay ho, nên khi về đến nhà, mình đã quyết định viết bài này để giới thiệu với mọi người và cũng coi như là bookmark lại cho tương lai lỡ có nếu gặp phải thì chỉ cần vào đây để xem lại.</p>

<h2 id="vấn-đề">Vấn đề</h2>

<p>Vấn đề mình gặp phải là: team mình đang phải làm việc với <code class="language-plaintext highlighter-rouge">kintone</code>, một công nghệ khá là củ củ chuối. Đại loại là kintone sẽ cung cấp giao diện kéo thả, dev sẽ viết code javascript để nhúng vào custom giao diện, cũng như là tính năng. Trong file script có sẵn của <code class="language-plaintext highlighter-rouge">kintone</code> thì đã implement sẵn sự kiện <code class="language-plaintext highlighter-rouge">onbeforeunload</code> để thông báo khi rời trang. Nhiều khi cái thông báo đó rất là khó chịu. Và hôm nay mình đã phải bỏ sự kiện <code class="language-plaintext highlighter-rouge">onbeforeunload</code> trong một file script khác.</p>

<p><img src="/assets/images/before-unload.png" alt="beforeunload" /></p>

<h2 id="giải-pháp">Giải pháp</h2>

<p>Đầu tiên là mình search trên google, cũng ra khá nhiều cách nhưng mình thử đều không được. Như là <code class="language-plaintext highlighter-rouge">window.onbeforeunload = null</code>. Cũng đã thử mò vào source code của kintone để xem nhưng file đó đã được build rồi, nên là không thể đọc được nó viết gì.</p>

<p>Sau đó thì mình nảy ra ý tưởng là sẽ ghi đè hàm <code class="language-plaintext highlighter-rouge">window.addEventListener</code> khi mà listener <code class="language-plaintext highlighter-rouge">beforeunload</code> thì mình sẽ không làm gì, đại loại là không cho listener sự kiện beforeunload. Code version 1 sẽ như sau</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">disableBeforeUnload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">oldAddEventListener</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">=</span> <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="p">[</span><span class="nx">type</span><span class="p">,</span> <span class="nx">listener</span><span class="p">]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">breforeunload</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="nx">oldAddEventListener</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Bạn chỉ cần gọi hàm này ở đầu file javascript thì mọi sự kiện <code class="language-plaintext highlighter-rouge">beforeunload</code> sẽ không được thực thi.</p>

<p>Hãy cùng nâng cấp chức năng của hàm này lên 1 chút nhé. Mình muốn bình thường vẫn listener sự kiện <code class="language-plaintext highlighter-rouge">beforeunload</code> khi nào mình gọi hàm này thì mới bỏ sự kiện đó đi. Và khi nào mình muốn listener lại cũng được. Kiểu như tạm dừng không cho gọi <code class="language-plaintext highlighter-rouge">beforeunload</code>. Code xử lý sẽ như sau</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">listeners</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">const</span> <span class="nx">oldAddEventListener</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">=</span> <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">type</span><span class="p">,</span> <span class="nx">listener</span><span class="p">]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">breforeunload</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">listeners</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">oldAddEventListener</span><span class="p">(...</span><span class="nx">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">disableBeforeUnload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">listeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">listener</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">beforeunload</span><span class="dl">'</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
    <span class="p">})</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">enableBeforeUnload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">listeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">listener</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">beforeunload</span><span class="dl">'</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
    <span class="p">})</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Khá là đơn giản đúng không. Hi vọng bài viết này sẽ hữu ích với các bạn.</p>


  <!-- 引入share模块 -->
  
  <div class="social-share-wrapper">
    <div class="social-share"></div>
  </div>


<!-- share.js -->
<script src="/assets/js/social-share.min.js"></script>
<script>
  socialShare('.social-share', {
    sites: [
      
        'twitter'
        ,
        
      
        'facebook'
        
      
    ],
    wechatQrcodeTitle: "分享到微信朋友圈",
    wechatQrcodeHelper: '期待在朋友圈见到这篇文章'
  });
</script>

</div>

<!-- 底部锚点 -->
<a id="htmldown" name="htmldown"></a>
<!-- 引入评论模块 -->

    <section class="post-footer-item comment">
      <div id="disqus_thread"></div>
    </section>

    <script>
      /**
       *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
       *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
      /*
      var disqus_config = function () {
      this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };
      */
      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
          s = d.createElement('script');
        /*写入自己的disqus信息*/
        s.src = '';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();

    </script>







<!-- 引入goto模块 -->
<div class="bounceInRight animated go">
  <a title="顶部切换页面" class="gototop" href="#htmlup" target="_self">
    <div class="box" style="font-family:'ffad_matroregular';">
        Top
    </div>
  </a>
  <a title="底部有disqus评论哦" class="gotobottom" href="#htmldown" target="_self">
    <div class="box" style="font-family:'ffad_matroregular';">
        Foot
    </div>
  </a>
</div>

<!-- 引入页面底部模块 -->
<footer id="bottom">
  <br>
  <span>Cốt đơ ©
  
  
  2020
  <br>
  Powered by <a href="https://www.jekyll.com.cn/">Jekyll</a> | <a href="https://github.com/xukimseven/HardCandy-Jekyll">HardCandy-Jekyll</a></span>
</footer>


<!-- 引用wow.js的动画效果 -->
<script src="/assets/js/wow.js"></script>
<script>
    var wow = new WOW({
        boxClass: 'wow',
        animateClass: 'animated',
        // offset: 600,
        mobile: true,
        live: true
    });
    wow.init();
</script>
<!-- 页面刷新回到顶部 -->
<script>
    window.onbeforeunload = function(){
        //刷新后页面自动回到顶部
        document.documentElement.scrollTop = 0;  //ie下
        document.body.scrollTop = 0;  //非ie
    }
</script>
<script src="/assets/js/main.js"></script>
</body>
</html>
